@model List<Knowledge>


<html>
<head>
    <title>Flashcard Exam</title>
    <style>
        body {
            font-family: 'Arial Unicode MS', sans-serif; /* Sử dụng font Arial Unicode MS cho body */
        }
        /* Tùy chỉnh font chữ cho các thành phần khác nếu cần thiết */

        .card-title {
            font-weight: normal; /* Để chắc chắn rằng font-weight là mặc định */
            line-height: 1.5; /* Điều chỉnh chiều cao dòng cho chữ tiếng Việt */
        }

        .form-check-label {
            font-size: 1rem; /* Kích thước chữ cho nhãn của radio button */
        }
    </style>
</head>
<body>

      <div class="container">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <a href="@Url.Action("GetKnowledge", "Knowledge", new { flashcardId = Model.FirstOrDefault()?.FlashcardId })" class="btn btn-danger btn-sm" style="align-self: flex-start;">&larr;</a>
            <h2 class="mb-4" style="text-align: center;">Flashcard Exam: @Model.FirstOrDefault()?.Flashcard?.FlashcardName.ToUpper()</h2>
        </div>

        @if (Model == null || !Model.Any())
        {
            <p>No questions found for this flashcard.</p>
        }
        else
        {
            <form asp-action="CheckAnswersFlashcard" method="post">
                <input type="hidden" name="flashcardId" value="@Model.FirstOrDefault()?.FlashcardId" />
                @for (int i = 0; i < Model.Count; i++)
                {
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="card-title"> Q@(i + 1): @Html.Raw(@Model[i].Knowledge1.Replace("\n", "<br>"))</h4> <!-- Hiển thị câu hỏi -->

                            <input type="hidden" name="knowledgeId" value="@Model[i].KnowledgeId" />

                            @if (Model[i].Flashcard != null && Model[i].Answer != null)
                            {
                                // Tạo một danh sách chứa các phương án trả lời bao gồm câu trả lời đúng
                                var correctAnswer = Model[i].Answer.ToUpper(); // Chuyển đổi câu trả lời đúng thành chữ thường
                                var otherAnswers = Model.Where(k => k.FlashcardId == Model[i].FlashcardId && !k.Answer.Equals(Model[i].Answer, StringComparison.OrdinalIgnoreCase))
                                                        .Select(k => k.Answer.ToUpper()) // Chuyển đổi các đáp án khác thành chữ thường
                                                        .Distinct() // Đảm bảo các đáp án khác không bị trùng lặp
                                                        .ToList();

                                // Trộn câu trả lời đúng vào danh sách
                                var answers = new List<string> { correctAnswer };
                                answers.AddRange(otherAnswers);

                                
                                  if (answers.Count > 4)
                                {
                                    answers = answers.OrderBy(a => Guid.NewGuid()).Take(4).ToList();
                                }

                                // Hiển thị các phương án trả lời dưới dạng radio button
                                foreach (var answer in answers)
                                {
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="userAnswer[@i]" id="userAnswer[@i]@answer" value="@answer">
                                        <label class="form-check-label" for="userAnswer[@i]@answer">@answer</label>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                }

                <button type="submit" class="btn btn-primary" onclick="return checkAnswer()">Submit Answers</button>
            </form>
        }
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    function checkAnswer() {
        // Loop through all radio button groups and check if at least one is checked
        var answered = true;
        var questions = document.querySelectorAll(".card");

        questions.forEach(function(question) {
            var radios = question.querySelectorAll("input[type='radio']");
            var hasChecked = false;

            radios.forEach(function(radio) {
                if (radio.checked) {
                    hasChecked = true;
                }
            });

            if (!hasChecked) {
                answered = false;
            }
        });

        if (!answered) {
            alert("Please select an answer for all questions.");
            return false; // Prevent form submission if no answer is selected
        }

        // If at least one answer is selected, allow form submission
        return true;
    }
</script>
</html>
